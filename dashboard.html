<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>COVID Dashboard</title>
		<link rel="stylesheet" type="text/css" href="stylesheet2.css" />
		<style></style>
	</head>
	<body>
		<h1 class="center">Corona Virus Dashboard</h1>
		<div class="container center" id="weeklyVaccinesTotal"></div>
		<h3 class="center">Weekly COVID19 Data</h3>
		<div class="container2 center">
			<br />
			<label for="weeks">Select a week to view:</label>
			<select onchange="weekCall()" name="weeks" id="weeks">
				<option value="" selected="selected">Select Week</option>
			</select>
		</div>
		<div class="container center" id="weeklyVaccines"></div>
		<h3 class="center">Demographic COVID19 Data</h3>
		<div class="container center">
			<button type="button" onclick="toggle1()" id="button1">
				Age groups change output
			</button>
		</div>

		<div
			class="container center"
			id="ageVaccines1"
			style="display: block"
		></div>
		
		<div class="container center" id="ageVaccines2" style="display: none"></div>
		<h3 class="center">Geographic COVID19 Data</h3>
		<div class="container center" id="countyMinMax">
			<br /><br />
		</div>

		<div class="container center">
			<button type="button" onclick="toggle2()" id="button1">
				Compare counties
			</button>
		</div>

		<div class="solo container center">
			<br />
			<label for="counties1">Select a county to view:</label>
			<select onchange="countyCall()" name="counties1" id="counties1">
				<option value="" selected="selected">Select County</option>
			</select>
		</div>
		
		<div class="multi container center" style="display:block">
			<br />
			<label for="countie2">Pick a county:</label>
			<select onchange="countyCall()" name="counties2" id="counties2">
				<option value="" selected="selected">Select County</option>
			</select>
			<select onchange="countyCall()" name="counties3" id="counties3">
				<option value="" selected="selected">Select County</option>
			</select>
			<select onchange="countyCall()" name="counties4" id="counties4">
				<option value="" selected="selected">Select County</option>
			</select>
		</div> 

		<div class="container center" id="countyData"></div>


		<script>

			var parsedWeeks;
			var parsedCountys;

			// Call weekInfo
			function weekCall() {
				var x = document.getElementById("weeks");
				var myWeek = x.value;
				weekInfo(parsedWeeks, myWeek);
			}

			// Call countyInfo
			function countyCall() {
				var x = document.getElementById("counties1");
				var mycounty = x.value;
				countyInfo(parsedCountys, mycounty);
			}

			// Inspired by W3 Schools
			// Swap age data div displayed
			function toggle1() {
				var div1 = document.getElementById("ageVaccines1");
				var div2 = document.getElementById("ageVaccines2");
				if (div1.style.display === "none") {
					div1.style.display = "block";
					div2.style.display = "none";
				} else {
					div1.style.display = "none";
					div2.style.display = "block";
				}
			}

			// Inspired by W3 Schools
			//Swap county comparison div displayed
			function toggle2() {
				var div1 = document.getElementByClassName("solo");
				var div2 = document.getElementByClassName("multi");
				if (div1.style.display === "none") {
					div1.style.display = "block";
					div2.style.display = "none";
				} else {
					div1.style.display = "none";
					div2.style.display = "block";
				}
			}

			// Parse week json file
			var xmlhttp1 = new XMLHttpRequest();
			var url =
				"https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_Weekly_Vaccination_Figures/FeatureServer/0/query?where=1%3D1&outFields=Week,TotalweeklyVaccines,Moderna,Pfizer,Janssen,AstraZeneca,FullyCum_Age10to19,FullyCum_Age20to29,FullyCum_Age40to49,FullyCum_Age30to39,FullyCum_Age50to59,FullyCum_Age60to69,FullyCum_Age70to79,FullyCum_80_,FullyPer_Age10to19,FullyPer_Age20to29,FullyPer_Age30to39,FullyPer_Age40to49,FullyPer_Age50to59,FullyPer_Age70to79,FullyPer_Age60to69,FullyPer_80_&outSR=4326&f=json";

			xmlhttp1.onreadystatechange = function () {
				if (xmlhttp1.readyState == 4 && xmlhttp1.status == 200) {
					parsedWeeks = JSON.parse(xmlhttp1.responseText);
					default_week(parsedWeeks);
					weekBuilder(parsedWeeks);
				}
			};
			xmlhttp1.open("GET", url, true);

			xmlhttp1.send();

			// Parse county json file
			var xmlhttp2 = new XMLHttpRequest();
			var url =
				"https://services1.arcgis.com/eNO7HHeQ3rUcBllm/arcgis/rest/services/Covid19CountyStatisticsHPSCIrelandOpenData/FeatureServer/0/query?where=1%3D1&outFields=ConfirmedCovidCases,PopulationProportionCovidCases,PopulationCensus16,CountyName&outSR=4326&f=json";

			xmlhttp2.onreadystatechange = function () {
				if (xmlhttp2.readyState == 4 && xmlhttp2.status == 200) {
					parsedCountys = JSON.parse(xmlhttp2.responseText);
					countyMinMax(parsedCountys);
					countyBuilder(parsedCountys);
					countyBuilder2(parsedCountys);
				}
			};
			xmlhttp2.open("GET", url, true);

			xmlhttp2.send();

			//XMLHttpRequest  error checking provided by javascript.info
			xhr.onload = function () {
				if (xhr.status != 200) {
					alert(`Error ${xhr.status}: ${xhr.statusText}`);
				}
			};

			xhr.onerror = function () {
				alert("Request failed");
			};

			// Default Week
			function default_week(data) {
				var myArray = parsedWeeks.features;
				var weekIndex = myArray.length - 1;
				var currentWeek = myArray[weekIndex].attributes.Week;
				weekInfo(data, currentWeek);
			}

			// Build week dropdown
			// Inspired by Encodedena.com walkthrough
			function weekBuilder() {
				var myArray = parsedWeeks.features;
				var myType = document.getElementById("weeks");
				for (var i = 1; i < myArray.length; i++) {
					var weekNo = myArray[i].attributes.Week;
					myType.innerHTML =
						myType.innerHTML +
						"<option value='" +
						weekNo +
						"'>" +
						"Week: " +
						i +
						"</option>";
				}
			}

			// Build county dropdown
			// Inspired by Encodedena.com walkthrough
			function countyBuilder() {
				var myArray = parsedCountys.features;
				var myType = document.getElementById("counties1");
				for (var i = 0; i < myArray.length; i++) {
					var countyName = myArray[i].attributes.CountyName;
					myType.innerHTML =
						myType.innerHTML +
						"<option value='" +
						countyName +
						"'>" +
						countyName +
						"</option>";
				}
			}
			// Build county dropdown
			// Inspired by Encodedena.com walkthrough
			function countyBuilder2() {
				var myArray = parsedCountys.features;
				var myType = document.getElementById("counties2");
				for (var i = 0; i < myArray.length; i++) {
					var countyName = myArray[i].attributes.CountyName;
					myType.innerHTML =
						myType.innerHTML +
						"<option value='" +
						countyName +
						"'>" +
						countyName +
						"</option>";
				}
			}

			// Read week json file data
			function weekInfo(obj, x) {
				var myArray = obj.features;

				var myInfo = "";
				var myInfo1 = "";
				var myInfo2 = "";
				var myInfo3 = "";
				var weeklyTotal = 0;
				//for (let i in myArray)
				for (let i = 1; i < myArray.length; i++) {
					var weekNo = myArray[i].attributes.Week;
					var weeklyVax = myArray[i].attributes.TotalweeklyVaccines;
					var moderna = myArray[i].attributes.Moderna;
					var pfizer = myArray[i].attributes.Pfizer;
					var az = myArray[i].attributes.AstraZeneca;
					var jandj = myArray[i].attributes.Janssen;
					var fc_19_ = myArray[i].attributes.FullyCum_Age10to19;
					var fc_29_ = myArray[i].attributes.FullyCum_Age20to29;
					var fc_39_ = myArray[i].attributes.FullyCum_Age30to39;
					var fc_49_ = myArray[i].attributes.FullyCum_Age40to49;
					var fc_59_ = myArray[i].attributes.FullyCum_Age50to59;
					var fc_69_ = myArray[i].attributes.FullyCum_Age60to69;
					var fc_79_ = myArray[i].attributes.FullyCum_Age70to79;
					var fc_80_ = myArray[i].attributes.FullyCum_80_;
					var weekNo = myArray[i].attributes.Week;
					var fp_19_ = myArray[i].attributes.FullyPer_Age10to19;
					var fp_29_ = myArray[i].attributes.FullyPer_Age20to29;
					var fp_39_ = myArray[i].attributes.FullyPer_Age30to39;
					var fp_49_ = myArray[i].attributes.FullyPer_Age40to49;
					var fp_59_ = myArray[i].attributes.FullyPer_Age50to59;
					var fp_79_ = myArray[i].attributes.FullyPer_Age70to79;
					var fp_69_ = myArray[i].attributes.FullyPer_Age60to69;
					var fp_80_ = myArray[i].attributes.FullyPer_80_;
					weeklyTotal = weeklyTotal + weeklyVax;
					if (weekNo == x) {
						myInfo +=
							"Total vacinations to date in 2021: " + weeklyTotal + "<br>";
						myInfo1 +=
							"<br>" +
							"Total Vacinations administered this week: " +
							weeklyVax +
							"<br>" +
							"Total Moderna vaccines administered: " +
							moderna +
							"<br>" +
							"Total Pfizervaccines administered: " +
							pfizer +
							"<br>" +
							"Total Janssen vaccines administered: " +
							jandj +
							"<br>" +
							"Total Astrazeneca vaccines administered: " +
							az +
							"<br><br>";

						myInfo2 +=
							"<br>" +
							"Citizens vaccinated age 10 to 19: " +
							fc_19_ +
							"<br>" +
							"Citizens vaccinated age 20 to 29: " +
							fc_29_ +
							"<br>" +
							"Citizens vaccinated age 30 to 39: " +
							fc_39_ +
							"<br>" +
							"Citizens vaccinated age 40 to 49: " +
							fc_49_ +
							"<br>" +
							"Citizens vaccinated age 50 to 59: " +
							fc_59_ +
							"<br>" +
							"Citizens vaccinated age 60 to 69: " +
							fc_69_ +
							"<br>" +
							"Citizens vaccinated age 70 to 79: " +
							fc_79_ +
							"<br>" +
							"Citizens vaccinated age 80+: " +
							fc_80_ +
							"<br><br>";

						myInfo3 +=
							"<br>" +
							"Citizens vaccinated age 10 to 19: " +
							(fp_19_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 20 to 29: " +
							(fp_29_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 30 to 39: " +
							(fp_39_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 40 to 49: " +
							(fp_49_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 50 to 59: " +
							(fp_59_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 60 to 69: " +
							(fp_69_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 70 to 79: " +
							(fp_79_ * 100).toFixed(0) +
							" %" +
							"<br>" +
							"Citizens vaccinated age 80+: " +
							(fp_80_ * 100).toFixed(0) +
							" %" +
							"<br><br>";
					}
				}
				document.getElementById("weeklyVaccinesTotal").innerHTML = myInfo;
				document.getElementById("weeklyVaccines").innerHTML = myInfo1;
				document.getElementById("ageVaccines1").innerHTML = myInfo2;
				document.getElementById("ageVaccines2").innerHTML = myInfo3;
			}

			// Read county json file data
			function countyInfo(obj, x) {
				var myArray = obj.features;

				var myInfo = "";
				for (let i in myArray) {
					var cases = myArray[i].attributes.ConfirmedCovidCases;
					var proportion = myArray[i].attributes.PopulationProportionCovidCases;
					var population = myArray[i].attributes.PopulationCensus16;
					var name = myArray[i].attributes.CountyName;
					if (name == x) {
						myInfo +=
							"<br>" +
							"Number of cases in the county: " +
							cases +
							"<br>" +
							"Proportinal cases in the county: " +
							proportion.toFixed(0) +
							"<br>" +
							"County Population: " +
							population +
							"<br>" +
							"<br><br>";
					}
				}
				document.getElementById("countyData").innerHTML = myInfo;
			}

			function countyMinMax(obj) {
				var myArray = obj.features;

				var maxCounter = 0;
				var minCounter = myArray[0].attributes.PopulationProportionCovidCases;
				var maxId = "";
				var minId = "";

				var myInfo = "";
				for (let i in myArray) {
					var proportion = myArray[i].attributes.PopulationProportionCovidCases;
					var name = myArray[i].attributes.CountyName;

					if (proportion > maxCounter) {
						maxCounter = proportion;
						maxId = name;
					}

					if (proportion < minCounter) {
						minCounter = proportion;
						minId = name;
					}
				}
				document.getElementById("countyMinMax").innerHTML =
					"County with highest instance of COVID19: " +
					minId +
					" " +
					minCounter.toFixed(2) +
					"<br>" +
					"County with lowest instance of COVID19: " +
					maxId +
					" " +
					maxCounter.toFixed(2);
			}
		</script>
	</body>
</html>
